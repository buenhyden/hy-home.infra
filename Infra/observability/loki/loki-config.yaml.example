auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096

common:
  instance_addr: 127.0.0.1
  path_prefix: /loki
  storage:
    s3:
      endpoint: http://minio:9000 # Docker 내부 MinIO 주소
      bucketnames: loki-bucket # Loki용 버킷 이름
      access_key_id: ${MINIO_ROOT_USER} # MinIO 아이디 (아래 Compose 설정 참고)
      secret_access_key: ${MINIO_ROOT_PASSWORD} # MinIO 비밀번호
      s3forcepathstyle: true # MinIO 필수 옵션
      insecure: true # HTTP 사용 허용
  replication_factor: 1
  ring:
    kvstore:
      store: inmemory

schema_config:
  configs:
    - from: 2020-10-24
      store: tsdb
      object_store: s3
      schema: v13
      index:
        prefix: index_
        period: 24h

# [추가] S3 사용 시 필수: 데이터 정리 및 보관 주기 관리
compactor:
  working_directory: /tmp/loki/compactor
  delete_request_store: s3
  compaction_interval: 10m
  retention_enabled: true
  retention_delete_delay: 2h
  retention_delete_worker_count: 150

# Ruler 설정
ruler:
  # 도커 컴포즈에서 alertmanager 서비스 이름이 alertmanager 라고 가정
  alertmanager_url: http://alertmanager:9093
  storage:
    type: local
    local:
      directory: /loki/rules

limits_config:
  reject_old_samples: true
  reject_old_samples_max_age: 168h # 1주일(168시간) 전 로그까지 허용 (기본값 1h -> 수정됨)
  max_cache_freshness_per_query: 10m
  split_queries_by_interval: 15m
